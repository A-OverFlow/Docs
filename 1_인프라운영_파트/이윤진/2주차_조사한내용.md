# (~3/18 파트가 변경되기 전 ..)
## 🔔 알림 기능
### 이벤트(댓글 달림 등) 발생 처리 장치는 어떤 것을 사용하면 좋을지?
- kafka
  - 디스크에 저장
  - 대규모 트래픽에 유리
- redis pub/sub
  - 메모리에 저장 (보관x)
  - 처리되면 사라짐
  - 단기적이고 빠른 메시지 전송에 효율적

→ **kafka** 사용하는 것으로 진행
### 다른 도메인의 데이터(사용자 계정 등) 조회 방법
1) 필요할 때마다 사용자 인증 서비스에 API 호출 
2) 알림 서비스에 DB 를 두고 필요한 데이터를 사용자 인증 서비스에서 복제
  - 데이터 동기화 규칙이 필요함 
  - 자주 변경되는 데이터 : 이벤트 기반 동기화 (이벤트가 발생하면 동기화)
  - 자주 변경되지 않는 데이터 : 주기적 동기화 (5분, 10분, ..)
  
→ 1)의 경우 네트워크 부하가 발생할 수 있기 때문에 **2) DB 동기화**로 진행
### 알림 데이터 저장 장치
- redis
  - 알림을 최대 30일까지만 저장하는 경우에 유리 -> 자동 삭제 설정할 수 있음
  - 빠름 
- RDB
  - 데이터를 디스크 저장하기 때문에 유실 위험 적음

→ 이미 다른 도메인의 데이터를 RDB에 저장하기로 했기 때문에, 알림 데이터도 **RDB** 사용하기로 함
### 논의해봐야 할 사항
- follow 기능 제공하는지? 
  - 특정 질문을 follow 한 경우, 해당 질문에 댓글이 달리면 알림 발생하는 기능
  - -> 문서에 없으므로 제공하지 않는것으로 함
### DB에 저장할 데이터
- 사용자 데이터 

| 컬럼     | 타입 | 설명         |
|----------|------|--------------|
| id (PK)  | INTEGER   | 사용자 id (인증 서비스에서 복제)       |
| user_name | VARCHAR(10) | 계정명 |
| popular_alert | BOOLEAN | 인기 질문 알림 설정 여부 |
...

- 알림 데이터 

| 컬럼     | 타입 | 설명         |
|----------|------|--------------|
| id (PK)  | SERIAL   | 알림 id       |
| user_id (FK)   | INTEGER   |   사용자 데이터 테이블의 PK   |
| alert_id   | INTEGER   | 알림 템플릿 id       |
| params    | TEXT  | 템플릿 포맷에 들어갈 파라미터 |
| if_read   | BOOLEAN | 사용자가 알림을 읽었는지 유무 |
| if_send   | BOOLEAN | 알림을 전송했는지 유무(재전송 방지) |
| created_time | TIMESTAMP WITHOUT TIME ZONE | 알림 생성 시간 |

# (3/18~ 파트가 변경된 후..😢)
## API Gateway 조사
### API Gateway VS API Gateway Pattern
- API Gateway
  - 지원하는 기능
    - 라우팅
    - 횡단관심사(인증/보안/모니터링/..)를 일관되게 처리
  - **서버 간 횡단관심사를 해결하는데 초점**
- API Gateway Pattern
  - MSA 에서 client 가 직접 서버에 API 호출하지 않고 프론트 서버를 통해, 프론트 서버가 중간에서 서버가 응답한 데이터 중 필요한 정보만 가공해서 client 에게 전달하는 설계 원칙
    - MSA 에서는 client 가 여러 서비스와 상호작용하게 되면서, 불필요한 정보가 client 에게 노출될 수도 있고, 비즈니스 정책이 노출될 수도 있음
  - **client 의 문제를 해결하는데 초점**
### API Gateway 의 SPOF(Single Point Of Failure, 단일 실패 지점) 문제를 어떻게 해결할지 ? 
- API Gateway를 scalable 하게 확장
- 서비스군을 서비스 영향도에 따라 분리 (like cluster)